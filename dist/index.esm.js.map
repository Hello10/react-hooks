{"version":3,"file":"index.esm.js","sources":["../src/useAnimationFrame.js","../src/useSingleton.js","../src/useStateBlob.js"],"sourcesContent":["import React, {useRef} from 'react';\n\nconst {requestAnimationFrame, cancelAnimationFrame} = window;\n\nexport default function useAnimationFrame (callback) {\n  const request = useRef();\n  const last_time = useRef();\n  const first_time = useRef();\n\n  function animate (time) {\n    let first = first_time.current;\n    if (first === undefined) {\n      first_time.current = time;\n      first = time;\n    }\n\n    const last = last_time.current;\n    if (last !== undefined) {\n      const delta = time - last;\n      const total = time - first;\n      callback({delta, total});\n    }\n\n    last_time.current = time;\n    request.current = requestAnimationFrame(animate);\n  }\n\n  React.useEffect(()=> {\n    request.current = requestAnimationFrame(animate);\n    return ()=> cancelAnimationFrame(request.current);\n  }, []);\n}\n","import React from 'react';\n\nclass Singleton {\n  static use (options = {}) {\n    if (!this.instance) {\n      this.instance = new this(options);\n    }\n    const {instance} = this;\n    const [, setState] = React.useState();\n    React.useEffect(()=> {\n      let is_mounted = true;\n      function setStateIfMounted (state) {\n        if (is_mounted) {\n          setState(state);\n        }\n      }\n      instance.addListener(setStateIfMounted);\n      return ()=> {\n        is_mounted = false;\n        instance.removeListener(setStateIfMounted);\n      };\n    }, []);\n    return instance;\n  }\n\n  constructor (options = {}) {\n    if (this.constructor.instance) {\n      throw new Error(\"Don't call singleton constructor directly\");\n    }\n\n    this.options = options;\n    this.listeners = [];\n\n    let {state = {}} = options;\n    if (state.constructor === Function) {\n      state = state();\n    }\n    this.state = this.initialize(state);\n  }\n\n  initialize (state) {\n    return state;\n  }\n\n  setState (state) {\n    this.state = {\n      ...this.state,\n      ...state\n    };\n\n    for (const listener of this.listeners) {\n      listener(this.state);\n    }\n  }\n\n  addListener (listener) {\n    this.listeners.push(listener);\n  }\n\n  removeListener (listener) {\n    this.listeners = this.listeners.filter((l)=> l !== listener);\n  }\n}\n\nexport default function useSingleton (Class, options = {}) {\n  return Class.use(options);\n}\nuseSingleton.Singleton = Singleton;\n","import {useReducer} from 'react';\n\nexport default function useStateBlob (initial) {\n  return useReducer((state, delta)=> {\n    return {\n      ...state,\n      ...delta\n    };\n  }, initial);\n}\n"],"names":["requestAnimationFrame","cancelAnimationFrame","window","useAnimationFrame","callback","request","useRef","last_time","first_time","animate","time","first","current","undefined","last","delta","total","React","useEffect","Singleton","use","options","instance","setState","useState","is_mounted","setStateIfMounted","state","addListener","removeListener","constructor","Error","listeners","Function","initialize","listener","push","filter","l","useSingleton","Class","useStateBlob","initial","useReducer"],"mappings":"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"}